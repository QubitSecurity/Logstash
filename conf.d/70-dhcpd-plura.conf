### 70-dhcpd-plura
### for dhcpd messages log

input {
   file {
     path           => "/var/log/plura/dhcpd.log"
     start_position => "beginning"
     sincedb_path   => "NUL"
   }
}

filter {
   grok {
    patterns_dir => ["/etc/logstash/patterns.d/"]
    match => { "message" => "%{PLURADHCPD}" }
   }

    ruby{ 
            code => "event.set('@timestamp', LogStash::Timestamp.new(event.get('@timestamp')+(9*60*60)))" 
    }

   if "_grokparsefailure" in [tags] { drop {} }

   mutate{
    rename       => {"@timestamp"      => "timegenerated" }
    rename       => {"timestamp"       => "DATE" }
    rename       => {"dhcp_device"     => "DEVICE"}
    rename       => {"dhcp_client_ip"  => "Client_IP"}
    rename       => {"dhcp_client_mac" => "Client_MAC"}
    rename       => {"dhcp_operation"  => "OPERATION"}
    rename       => {"message"         => "msg"}

    remove_field => ["@version","path"]
   }
}

output {
   stdout { codec => rubydebug }
   file { 
          codec => "json_lines"
          path  => ["/var/log/plura/app-logstash-named.log"]
   }
}
